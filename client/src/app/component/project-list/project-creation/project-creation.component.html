<div class="container">

  <!-- SOP List back button -->
  <div class="row row-first">
    <div class="col">
      <button type="button" class="btn btn-outline-danger waves-effect" data-toggle="modal" data-target="#warningModal"><h6 class="no-margin-bottom"><i class="fa fa-times mr-3"></i>Back</h6></button>
    </div>
  </div>

  <!-- Project Form -->
  <div class="row row-first justify-content-center">

    <!-- Card -->
    <div class="col card card-cascade hoverable">

      <!-- Card content -->
      <div class="card-body card-body-cascade">

        <p class="card-title h4 text-center mb-4">Project Creation</p>

        <!-- Form -->
        <form (ngSubmit)="onSubmit()">

          <!-- SOP Model -->
          <div [hidden]="stepSelected != 0">
            <div class="row md-form">

              <div class="offset-2 col-8">
                <p class="text-center mb-4 text-description"> Please select a SOP model to begin your project </p>
                <select [(ngModel)]="sop_id_selected" name="sop_id_selected" (click)="loadJobsFromSop(); loadUnitsFromSop();" class="form-control" multiple>
                  <option value="" disabled selected>Choose your model</option>
                  <option *ngFor="let sop of sops" value="{{sop.sop_id}}">{{sop.sop_title}}</option>
                </select>
              </div>
            </div>
            <div class="row justify-content-center">
              <div>
                <button [disabled]="sop_id_selected == null" class="btn btn-primary waves-effect" type="button" (click)="changeStep(true)">Next</button>
              </div>
            </div>
          </div>

          <!-- Project name -->
          <div [hidden]="stepSelected != 1">
            <div class="row md-form">
              <p class="col-12 text-center mb-4 text-description"> Please choose a project name </p>
              <div class="offset-2 col-8">
                <input [(ngModel)]="new_project_title" name="new_project_title" type="text" id="newTitle" class="form-control">
                <label for="newTitle">Project name</label>
              </div>
            </div>
            <div class="row justify-content-center">
              <div>
                <button class="btn btn-danger waves-effect" type="button" (click)="changeStep(false)">Back</button>
              </div>
              <div>
                <button [disabled]="new_project_title == ''" class="btn btn-primary waves-effect" type="button" (click)="changeStep(true)">Next</button>
              </div>
            </div>
          </div>

          <!-- Job selection -->
          <div [hidden]="stepSelected != 2">

            <div class="row md-form">
              <p class="col-12 text-center mb-4 text-description"> Please choose one or more jobs </p>
            </div>

            <div class="row">
              <div class="col-12">
                <div class="card-body card-body-cascade">

                  <!--Table-->
                  <table class="table table-borderless table-hover table-fixed" id="job-table">

                    <!--Table head-->
                    <thead class="">
                    <tr class="text-white">
                      <th style="width:10%">Selected</th>
                      <th style="width:40%;" ><a>Job Code</a></th>
                      <th style="width:40%;" ><a>Job Name</a></th>
                      <th class="text-center" style="width:10%;" ><a>Activities</a></th>
                    </tr>
                    </thead>
                    <!--Table head-->

                    <!--Table body-->
                    <tbody>
                    <tr *ngFor="let job of jobs">
                      <td class="text-center">
                        <input type="checkbox" class="form-check-input" (click)="pickJob(job)" id="{{job.job_id}}">
                      </td>
                      <td>{{job.job_code}}</td>
                      <td>{{job.job_name}}</td>
                      <td class="text-center">
                        <a><i class="fa fa-eye text-blue"></i></a>
                      </td>
                    </tr>
                    </tbody>
                    <!--Table body-->

                  </table>
                  <!--Table-->

                </div>
              </div>
            </div>

            <div class="row justify-content-center">
              <div>
                <button class="btn btn-danger waves-effect" type="button" (click)="changeStep(false)">Back</button>
              </div>
              <div>
                <button [disabled]="jobs_selected.length == 0" class="btn btn-primary waves-effect" type="button" (click)="changeStep(true); loadActivityFromJob();">Next</button>
              </div>
            </div>
          </div>
          <!-- Job selection -->

          <!-- Unit affectation -->
          <div [hidden]="stepSelected != 3">
            <div class="row md-form">
              <div class="offset-2 col-8">
                <p class="text-center mb-4 text-description"> Choose an unit and pick members you want to add into </p>
                <select name="unit_id_selected" class="form-control" multiple>
                  <option value="" disabled selected>Choose an unit</option>
                  <option *ngFor="let unit of units" (click)="pickUnit(unit); " value="{{unit.unit_id}}">{{unit.unit_name}}</option>
                </select>
              </div>
            </div>
            <div class="row md-form">
              <div class="offset-2 col-8">
                <select [(ngModel)]="member_selected" name="member_selected" class="form-control" multiple>
                  <option value="" disabled selected>Add a member to the selected unit</option>
                  <option *ngFor="let member of members" (click)="pickMember(member); ">{{member.member_name}} {{member.member_first_name}}</option>
                </select>
              </div>
            </div>
            <div class="row justify-content-center">
              <div>
                <button class="btn btn-danger waves-effect" type="button" (click)="changeStep(false)">Back</button>
              </div>
              <div>
                <button class="btn btn-primary waves-effect" type="button" (click)="changeStep(true)">Next</button>
              </div>
            </div>
          </div>
          <!-- Unit affectation -->

          <!-- Activity affectation -->
          <div [hidden]="stepSelected != 4">
            <div class="row md-form">
              <div class="offset-2 col-8">
                <p class="text-center mb-4 text-description"> Choose an activity and pick unit you want to bind with</p>
                <select name="activity_id_selected" class="form-control" multiple>
                  <option value="" disabled selected>Choose an activity</option>
                  <option *ngFor="let activity of activities_binded" (click)="pickActivity(activity); " value="{{activity.activity_id}}">{{activity.activity_title}}</option>
                </select>
              </div>
            </div>
            <div class="row md-form">
              <div class="offset-2 col-8">
                <select [(ngModel)]="member_selected" name="member_selected" class="form-control" multiple>
                  <option value="" disabled selected>Add a member to the selected unit</option>
                  <option *ngFor="let unit of units" (click)="bindUnitActivity(unit); ">{{unit.unit_name}}</option>
                </select>
              </div>
            </div>
            <div class="row justify-content-center">
              <div>
                <button class="btn btn-danger waves-effect" type="button" (click)="changeStep(false)">Back</button>
              </div>
              <div>
                <button class="btn btn-primary waves-effect" type="button" (click)="changeStep(true)">Next</button>
              </div>
            </div>
          </div>
          <!-- Activity affectation -->

        </form>
        <!-- Form -->

      </div>
      <!-- Card content -->

    </div>
    <!-- Card -->

  </div>
  <!-- Project Form -->


  <!--Title of the unit-->
  <div class="row row-first" [hidden]="stepSelected != 3 && stepSelected != 4" >
    <h4>
      <span class="badge badge-pill badge-primary" *ngIf="unit_selected != null && stepSelected == 3">{{unit_selected.unit_name}}</span>
      <span class="badge badge-pill badge-primary" *ngIf="activity_selected != null && stepSelected == 4">{{activity_selected.activity_title}}</span>
    </h4>
    <!-- Error alert -->
    <div *ngIf="errorMessage" class="col offset-2 row justify-content-end error-text">
      <i>{{errorMessage}}</i>
    </div>
  </div>

  <!-- Member Unit Binding Display -->
  <div class="row row-last justify-content-center" [hidden]="stepSelected != 3 && stepSelected != 4">

    <!-- Card -->
    <div class="col card card-cascade hoverable">

      <!-- Card content -->
      <div class="card-body card-body-cascade">

        <table class="table table-borderless table-hover table-fixed" id="member-table">

          <!--Table head-->
          <thead class="">
          <tr class="text-white" *ngIf="unit_selected != null && stepSelected == 3">
            <th style="width:40%;"  (click)="sortTable(0)"><a>Last Name</a></th>
            <th style="width:40%;" (click)="sortTable(1)"><a>First Name</a></th>
            <th style="width:10%;">Remove</th>
          </tr>

          <tr class="text-white" *ngIf="unit_binded != null && stepSelected == 4">
            <th style="width:70%;"  (click)="sortTable(0)"><a>Last Name</a></th>
            <th style="width:30%;">Remove</th>
          </tr>
          </thead>



          <tbody *ngIf="unit_selected != null && stepSelected == 3">

          <tr *ngFor="let member of members_binded[units.indexOf(unit_selected)]">
            <td>{{member.member_name}}</td>
            <td>{{member.member_first_name}}</td>
            <td>
              <a (click)="removeMember(member)"><i class="fa fa-close text-red"></i></a>
            </td>
          </tr>

          <tbody *ngIf="unit_binded != null && stepSelected == 4">

          <tr *ngFor="let unit of unit_binded[activities_binded.indexOf(activity_selected)]">
            <td>{{unit.unit_name}}</td>
            <td>
              <a (click)="removeUnit(unit)"><i class="fa fa-close text-red"></i></a>
            </td>
          </tr>

          </tbody>
        </table>
      </div>
      <!-- Card content -->
    </div>
    <!-- Card -->

  </div>
  <!-- Activity Display -->



</div>

<!-- Modal warning -->
<app-warning title="Exit"
                  text="Are you sure you want to exit ? All your work will be lost."
                  [isLink]=true
                  link="project-list">
</app-warning>
