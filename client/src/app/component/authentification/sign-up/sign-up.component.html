<div class="container" *ngIf="!ready">
  <div class="row-first">
    <app-loader></app-loader>
  </div>
</div>

<div *ngIf="!displayEnd && ready" class="container">
  <div class="row row-first justify-content-center">

    <!-- Card -->
    <div class="col-10 col-sm-8 col-md-6 col-xl-4 card card-cascade hoverable">

      <!-- Card content -->
      <div class="card-body card-body-cascade">

      <!-- Material form register -->
      <form (ngSubmit)="onSubmitRegistration()">
        <p class="h4 text-center mb-4">Sign up</p>

        <!-- First step of the form -->
        <div [hidden]="!step1">

          <!-- Input first name -->
          <div class="md-form">
            <i class="fa fa-user prefix grey-text"></i>
            <input [(ngModel)]="firstName" name="firstName" type="text" id="firstName" class="form-control">
            <label for="firstName">First name</label>
          </div>

          <!-- Input last name -->
          <div class="md-form">
            <i class="fa fa-user prefix grey-text"></i>
            <input [(ngModel)]="lastName" name="lastName" type="text" id="lastName" class="form-control">
            <label for="lastName">Last name</label>
          </div>

          <!-- Input email -->
          <div class="md-form">
            <i class="fa fa-envelope prefix grey-text"></i>
            <input [(ngModel)]="email" name="email" type="email" id="email" class="form-control">
            <label for="email">Your email</label>
          </div>

          <!-- Input email confirmation -->
          <div class="md-form">
            <i class="fa fa-exclamation-triangle prefix grey-text"></i>
            <input [(ngModel)]="emailConfirmation" name="emailConfirmation" type="email" id="emailConfirm" class="form-control">
            <label for="emailConfirm">Confirm your email</label>
          </div>

          <!-- Input password -->
          <div class="md-form">
            <i class="fa fa-lock prefix grey-text"></i>
            <input [(ngModel)]="password" name="password" type="password" id="password" class="form-control">
            <label for="password">Your password</label>
          </div>

          <!-- Input password confirmation -->
          <div class="md-form">
            <i class="fa fa-exclamation-triangle prefix grey-text"></i>
            <input [(ngModel)]="passwordConfirmation" name="passwordConfirmation" type="password" id="passwordConfirm" class="form-control">
            <label for="passwordConfirm">Confirm your password</label>
          </div>

          <div class="">
            <select [(ngModel)]="managmentLevelChoosen" name="managementLevel" class="form-control">
              <option name="organisation" value="" disabled selected>Choose a management level</option>
              <option *ngFor="let manage of managmentLevels" [ngValue]=manage.managment_level_id>{{manage.managment_level_label}}</option>
            </select>
          </div>
        </div>

        <!-- Error alert -->
        <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
          {{errorMessage}}
        </div>

        <!-- Second step of the form -->
        <div class="form-group" [hidden]="!step2">

          <div class="row" *ngIf="organisation_elements.length != 0">
            <div class="col-12">
              <select (change)="pickOrganisation()" name="organisation" [(ngModel)]="organisation" class="form-control">
                <option name="organisation" value="" disabled selected>Choose organisation</option>
                <option *ngFor="let o of organisation_elements" [ngValue]="o">{{o['organisation'].organisation_name}}</option>
              </select>
            </div>
          </div>

          <div class="row" *ngIf="organisation != null">
            <div class="col-12">
              <select (change)="pickBranch()" name="branch" [(ngModel)]="branch" class="form-control">
                <option name="organisation" value="" disabled selected>Choose branch</option>
                <option *ngFor="let b of organisation['branchs']" [ngValue]="b">{{b['branch'].branch_name}}</option>
              </select>
            </div>
          </div>

          <div class="row" *ngIf="branch != null">
            <div class="col-12">
              <select (change)="pickDepartment()" name="department" [disabled]="branch['branch'].branch_name == 'No branch'" [(ngModel)]="department" class="form-control">
                <option name="organisation" value="" disabled selected>Choose department</option>
                <option *ngFor="let d of branch['departments']" [ngValue]="d">{{d['department'].department_name}}</option>
              </select>
            </div>
          </div>

            <div class="row" *ngIf="department != null">
              <div class="col-12">
                <select name="sub_department" [disabled]="department['department'].department_name == 'No department'" [(ngModel)]="sub_department" class="form-control">
                  <option name="organisation" value="" disabled selected>Choose a sub department</option>
                  <option *ngFor="let s of department['sub_departments']" [ngValue]="s">{{s.sub_department_name}}</option>
                </select>
              </div>
            </div>
        </div>

        <div class="text-center mt-4">
          <a class="btn btn-default" (click)="firstStepVerification()" [hidden]="!step1" >Next</a>
          <a class="btn btn-default" (click)="changeStep()" [hidden]="!step2" >Back</a>
          <button class="btn btn-default" type="" [hidden]="!step2" >Sign Up</button>
        </div>

      </form>
      <!-- Material form register -->

      <hr>

      <div class="row justify-content-center">
        <!-- Forgotten password -->
        <p class="font-small grey-text d-flex justify-content-end mt-3">Already have an account ? <a [routerLink]="['/authentification']" class="dark-grey-text ml-1 font-weight-bold text-link"> Sign in</a></p>
        <!--<a class="px-2 fa-lg email-ic"><i class="fa fa-envelope"> </i></a>-->
      </div>

      </div>
    </div>

  </div>
</div>

<app-summary *ngIf="displayEnd"
             title="Your account was created"
             text="To complete your registration please follow the instruction on the mail you received and wait for the admin validation"
             buttonTitle="Home" link="home">
</app-summary>

<!--


-->

<script>
  $(document).ready(function() {
  $('.mdb-select').material_select();
});
</script>
