<div class="container">

  <!-- Back button -> Sop List -->
  <div class="row row-first">
    <div class="col">
      <button type="button" class="btn btn-outline-danger waves-effect" data-toggle="modal" data-target="#warningModal"><h6 class="no-margin-bottom"><i class="fa fa-times mr-3"></i>Exit</h6></button>
    </div>
  </div>

  <!-- Activity Form -->

  <div class="row row-first justify-content-center">

    <!-- Card -->
    <div class="col card card-cascade hoverable">

      <!-- Card content -->
      <div class="card-body card-body-cascade" [hidden]="!step1">

        <p class="h4 text-center mb-4">Activities Creation</p>

        <!-- Activity Form -->
        <form (ngSubmit)="onSubmit()">

          <!-- Title -->
          <div class="row md-form">
            <div class="offset-1 col-10">
              <input [(ngModel)]="newActivityTitle" name="newActivityTitle" type="text" id="newActivityTitle" class="form-control">
              <label for="newActivityTitle">Activity Name</label>
            </div>
          </div>

          <!-- Description -->
          <div class="row md-form">
            <div class="offset-1 col-10">
              <textarea [(ngModel)]="newActivityDescription" name="newActivityDescription" type="text" id="newActivityDescription" class="form-control md-textarea" rows="1" ></textarea>
              <label for="newActivityDescription">Activity description</label>
            </div>
          </div>

          <!-- Management Level -->
          <div class="row md-form">
            <div class="offset-1 col-10">
              <p class="text-center mb-4 text-description"> Please select a management level </p>
              <select [(ngModel)]="newActivityLevelId" name="newActivityLevelId" class="form-control">
                <option value="" disabled selected>Choose your management level</option>
                <option *ngFor="let m of managmentLevelsArray" value="{{m.managment_level_id}}">{{m.managment_level_label}}</option>
              </select>
            </div>
          </div>

          <!-- Unit -->
          <div class="row md-form">
            <div class="offset-1 col-10">
              <p class="text-center mb-4 text-description"> Please select a unit</p>
              <select [(ngModel)]="unit_id_selected" name="unit_id_selected" class="form-control">
                <option value="" disabled selected>Choose an unit</option>
                <option *ngFor="let u of units" value="{{u.unit_id}}">{{u.unit_name}}</option>
              </select>
            </div>
          </div>

          <!-- Type Duration -->
          <div class="row md-form">
            <div class="offset-1 col-10">
              <p class="text-center mb-4 text-description"> Please select a duration type </p>
              <select [(ngModel)]="newActivityTypeDuration" name="newActivityTypeDuration" class="form-control">
                <option value="" disabled selected>Choose your duration type</option>
                <option value="minutes">Minute</option>
                <option value="hours">Hour</option>
                <option value="days">Day</option>
                <option value="weeks">Week</option>
                <option value="months">Month</option>
              </select>
            </div>
          </div>

          <!-- Duration -->
          <div class="row md-form">
            <div class="offset-1 col-10">
              <input [(ngModel)]="newActivityDuration" name="newActivityDuration" type="number" id="newActivityDuration" class="form-control">
              <label for="newActivityDuration">Duration</label>
            </div>
          </div>

          <!-- Type output -->
          <div class="row md-form">
            <div class="offset-1 col-10">
              <input [(ngModel)]="newActivityTypeOutput" name="newActivityTypeOutput" type="text" id="newActivityTypeOutput" class="form-control">
              <label for="newActivityTypeOutput">Type of output</label>
            </div>
          </div>

          <div class="row md-form">
            <div class="offset-1 col-5">
              <button class="btn btn-primary waves-effect" type="button" (click)="addNewActivity()">Add</button>
            </div>
            <div class="col-5 row justify-content-end">
              <div class="">
                <button [disabled]="activityArray.length == 0" class="btn btn-success waves-effect" data-toggle="modal" data-target="#confirmationModal" type="button">Finish</button>
              </div>
            </div>
          </div>

        </form>

      </div>
      <!-- Card content -->

      <!-- Card content -->
      <div class="card-body card-body-cascade" [hidden]="!step2">

        <p class="h4 text-center mb-4">Sub Activity Creation</p>

        <!-- Activity Form -->
        <form (ngSubmit)="onSubmit()">

          <!-- Title -->
          <div class="row md-form">
            <div class="offset-1 col-10">
              <input [(ngModel)]="newSubActivityTitle" name="newActivityTitle" type="text" id="newSubActivityTitle" class="form-control">
              <label for="newSubActivityTitle">Sub Activity Name</label>
            </div>
          </div>

          <!-- Description -->
          <div class="row md-form">
            <div class="offset-1 col-10">
              <textarea [(ngModel)]="newSubActivityDescription" name="newActivityDescription" type="text" id="newSubActivityDescription" class="form-control md-textarea" rows="1" ></textarea>
              <label for="newSubActivityDescription">Sub Activity description</label>
            </div>
          </div>

          <!-- Management Level -->
          <div class="row md-form">
            <div class="offset-1 col-10">
              <p class="text-center mb-4 text-description"> Please select a management level </p>
              <select [(ngModel)]="newSubActivityLevelId" name="newSubActivityLevelId" class="form-control">
                <option value="" disabled selected>Choose your management level</option>
                <option *ngFor="let m of managmentLevelsArray" value="{{m.managment_level_id}}">{{m.managment_level_label}}</option>
              </select>
            </div>
          </div>

          <!-- Unit -->
          <div class="row md-form">
            <div class="offset-1 col-10">
              <p class="text-center mb-4 text-description"> Please select a unit</p>
              <select [(ngModel)]="unit_id_selected" name="unit_id_selected" class="form-control">
                <option value="" disabled selected>Choose an unit</option>
                <option *ngFor="let u of units" value="{{u.unit_id}}">{{u.unit_name}}</option>
              </select>
            </div>
          </div>

          <!-- Type Duration -->
          <div class="row md-form">
            <div class="offset-1 col-10">
              <p class="text-center mb-4 text-description"> Please select a duration type </p>
              <select [(ngModel)]="newSubActivityTypeDuration" name="newSubActivityTypeDuration" class="form-control">
                <option value="" disabled selected>Choose your duration type</option>
                <option value="minutes">Minute</option>
                <option value="hours">Hour</option>
                <option value="days">Day</option>
                <option value="weeks">Week</option>
                <option value="months">Month</option>
              </select>
            </div>
          </div>

          <!-- Duration -->
          <div class="row md-form">
            <div class="offset-1 col-10">
              <input [(ngModel)]="newSubActivityDuration" name="newActivityDuration" type="number" id="newSubActivityDuration" class="form-control">
              <label for="newSubActivityDuration">Duration</label>
            </div>
          </div>

          <!-- Type output -->
          <div class="row md-form">
            <div class="offset-1 col-10">
              <input [(ngModel)]="newSubActivityTypeOutput" name="newActivityTypeOutput" type="text" id="newSubActivityTypeOutput" class="form-control">
              <label for="newSubActivityTypeOutput">Type of output</label>
            </div>
          </div>

          <div class="row md-form">
            <div class="offset-1 col-5">
              <button class="btn btn-primary waves-effect" type="button" (click)="addNewSubActivity()">Add</button>
            </div>
            <div class="col-5 row justify-content-end">
              <div class="">
                <button class="btn btn-primary waves-effect" type="button" (click)="changeStep(true)">Back</button>
              </div>
            </div>
          </div>

        </form>


      </div>
      <!-- Card content -->

    </div>
    <!-- Card -->

  </div>

  <!-- Activity Form -->

  <!--Title of the step-->
  <div class="row row-first">
    <h4>
      <span class="badge badge-pill badge-primary" [hidden]="!step1">Activity List</span>
      <span class="badge badge-pill badge-primary" [hidden]="!step2">Activity List</span>
    </h4>
    <!-- Error alert -->
    <div *ngIf="errorMessage" class="col offset-2 row justify-content-end error-text">
      <i>{{errorMessage}}</i>
    </div>
  </div>

  <!-- SOP Display -->
  <div class="row row-last justify-content-center">

    <!-- Card -->
    <div class="col card card-cascade hoverable">

      <!-- Card content -->
      <div class="card-body card-body-cascade">

        <table class="table table-borderless table-hover table-fixed" id="activiy-table">

          <!--Table head-->
          <thead class="">
          <tr class="text-white">
            <th style="width:1%;"></th>
            <th style="width:40%;"  (click)="sortTable(1)"><a>Title</a></th>
            <th style="width:10%;" (click)="sortTable(2)"><a>Duration</a></th>
            <th style="width:40%;" (click)="sortTable(3)"><a>Type of output</a></th>
            <th style="width:5%;"></th>
          </tr>
          </thead>

          <tbody>

          <tr *ngFor="let element of activityArray" (change)="isCheckboxActive()" [hidden]="!step1">
            <td class="text-center">
              <input type="checkbox" class="form-check-input" (click)="checkActivity(element)" [checked]="checkboxActive(element)" autocomplete="off">
            </td>
            <td>{{element.activity_title}}</td>
            <td>{{element.activity_duration}} {{element.activity_type_duration}}</td>
            <td>{{element.activity_type_output}}</td>
            <td>
              <a (click)="deleteActivity(element.activity_id)"><i class="fa fa-close text-red"></i></a>
            </td>
          </tr>

          <button [disabled]="!isCheckboxChecked" class="btn btn-primary waves-effect text-end" type="button" (click)="changeStep(false)" [hidden]="!step1">Add Sub Activities</button>

          <tr *ngFor="let element of subActivityArray[activityArray.indexOf(activitySelected)]" [hidden]="!step2">
            <td></td>
            <td>{{element.activity_title}}</td>
            <td>{{element.activity_duration}} {{element.activity_type_duration}}</td>
            <td>{{element.activity_type_output}}</td>
            <td>
              <a (click)="deleteActivity(element.activity_id)"><i class="fa fa-close text-red"></i></a>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
      <!-- Card content -->
    </div>
    <!-- Card -->

  </div>
  <!-- Activity Display -->

  <!-- Activity link display -->
  <div class="row row-first justify-content-center" [hidden]="step1">

    <!-- Card -->
    <div class="col card card-cascade hoverable">



    </div>
    <!-- Card -->

  </div>
  <!-- Activity link display -->

</div>

<!-- Modal confirmation -->
<app-confirmation title="Confirmation activities creation"
                  text="Are you sure all informations provided are correct ?"
                  [isLinkActive]=true
                  link="sop-list"
                  >
</app-confirmation>

<!-- Modal warning -->
<app-warning title="Exit"
             text="Are you sure you want to go back to the SOP list ?"
             [isLink]=true
             link="sop-list">
</app-warning>


<script>
  // Tooltips Initialization
  $(function () {
    $('[data-toggle="tooltip"]').tooltip()
  })
</script>
